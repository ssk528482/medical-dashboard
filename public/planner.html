<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f172a">
  <link rel="manifest" href="manifest.json">
  <title>Planner — Medical Study OS</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ── Topic chip styles ── */
    .topic-chip {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      background: var(--surface);
      color: var(--text-muted);
      border: 1px solid var(--border);
      transition: all 0.15s;
      white-space: nowrap;
    }
    .topic-chip.selected {
      background: rgba(59,130,246,0.18) !important;
      color: #93c5fd !important;
      border-color: #3b82f6 !important;
    }
    body.light .topic-chip.selected {
      background: rgba(59,130,246,0.14) !important;
      color: #1d4ed8 !important;
    }
    .topic-chip.already-done {
      background: rgba(16,185,129,0.12);
      color: #4ade80;
      border-color: #166534;
    }
    body.light .topic-chip.already-done {
      background: rgba(16,185,129,0.12);
      color: #15803d;
      border-color: #16a34a;
    }
    /* Evening submitted card */
    .evening-submitted-card {
      background: linear-gradient(135deg, #0f2b1a, #0a1f12);
      border: 1px solid #16a34a;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 10px;
    }
    body.light .evening-submitted-card {
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      border-color: #16a34a;
    }
    .evening-entry-line {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
      color: var(--text-muted);
    }
    .evening-entry-line:last-child { border-bottom: none; }
    .entry-icon { font-size: 15px; flex-shrink: 0; margin-top: 1px; }
    /* Section separator */
    .form-section {
      background: var(--card);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 12px;
      border: 1px solid var(--border);
    }
    .form-section-title {
      font-weight: 700;
      font-size: 13px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    /* ── Stopwatch ── */
    .sw-block { background:var(--card);border-top:1px solid var(--border);border-radius:0 0 10px 10px;padding:10px 12px;margin-top:8px; }
    .sw-row   { display:flex;align-items:center;gap:10px;flex-wrap:wrap; }
    .sw-display { font-size:22px;font-weight:800;font-family:'SF Mono','Fira Code',monospace;min-width:86px;letter-spacing:1px; }
    .sw-target  { font-size:11px;color:var(--text-dim);flex:1;min-width:60px; }
    .sw-status  { font-size:11px;font-weight:700;padding:2px 8px;border-radius:5px; }
    .sw-status.on-target { background:rgba(16,185,129,0.15);color:#15803d; }
    body:not(.light) .sw-status.on-target { background:#052e16;color:#4ade80; }
    .sw-status.over      { background:rgba(239,68,68,0.13);color:#dc2626; }
    body:not(.light) .sw-status.over { background:#450a0a;color:#fca5a5; }
    .sw-status.under     { background:rgba(59,130,246,0.13);color:#2563eb; }
    body:not(.light) .sw-status.under { background:#1e3a5f;color:#93c5fd; }
    .sw-btn { padding:6px 14px;border-radius:8px;font-size:12px;font-weight:700;border:none;cursor:pointer;margin:0; }
    .sw-btn.start { background:#16a34a;color:white; }
    .sw-btn.pause { background:#d97706;color:white; }
    .sw-btn.reset { background:var(--surface);color:var(--text-muted);border:1px solid var(--border); }
    .sw-bar-wrap  { height:5px;background:var(--border);border-radius:3px;margin-top:8px;overflow:hidden; }
    .sw-bar-fill  { height:100%;border-radius:3px;transition:width .8s linear; }
    /* Pin button states */
    .pin-btn-default { background:#1e3a5f;color:#93c5fd;border:1px solid #2a4f80; }
    body.light .pin-btn-default { background:rgba(59,130,246,0.12);color:#1d4ed8;border-color:#93c5fd; }
    .pin-btn-pinned { background:#052e16;color:#4ade80;border:1px solid #166534; }
    body.light .pin-btn-pinned { background:rgba(16,185,129,0.12);color:#15803d;border-color:#16a34a; }
    .unpin-btn { background:var(--surface);color:var(--text-muted);border:1px solid var(--border); }
  </style>
</head>
<body>
<script src="nav.js"></script>

<script src="router.js"></script>

<h1>📋 Daily Planner</h1>

<!-- Morning Plan -->
<div class="card">
  <div class="section-title">☀️ Morning Planner</div>
  <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
    <div>
      <label style="font-size:12px;color:#94a3b8;display:block;margin-bottom:3px;">Hours Available</label>
      <input type="number" id="dailyHours" style="width:90px;" min="1" max="16" placeholder="hrs">
    </div>
    <div style="display:flex;gap:8px;align-items:flex-end;padding-top:18px;">
      <button id="generateButton" onclick="generatePlan()">Generate Plan</button>
      <button onclick="resetTodayPlan()" style="background:#ef4444;font-size:12px;padding:8px 10px;margin-top:0;">Reset</button>
    </div>
  </div>
  <!-- #16 Subject pin override -->
  <div style="margin-top:10px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;">
    <label style="font-size:12px;color:#64748b;">📌 Pin subject:</label>
    <select id="pinSubjectSelect" style="font-size:12px;padding:5px 8px;flex:1;min-width:120px;max-width:200px;">
      <option value="">Auto (recommended)</option>
    </select>
    <button id="pinBtn" onclick="pinSubjectForToday()" class="pin-btn-default" style="font-size:12px;padding:6px 10px;margin:0;">📌 Pin</button>
    <button onclick="unpinSubject()" class="unpin-btn" style="font-size:12px;padding:6px 8px;margin:0;">✕ Unpin</button>
  </div>
  <div id="planOutput" style="margin-top:10px;"></div>
</div>

<!-- Heatmap -->
<div class="card">
  <div class="section-title">📅 60-Day Consistency</div>
  <div id="heatmapContainer"></div>
</div>

<!-- Evening Update -->
<div class="card" id="eveningUpdateCard">
  <div class="section-title" style="margin-bottom:0;">🌙 Evening Update</div>
  <div style="font-size:11px;color:#475569;margin-bottom:14px;">Log what you completed today</div>
  <div id="eveningUpdateInner"></div>
</div>

<!-- Bottom Nav (5 items) -->


<script src="utils.js"></script>
<script src="data.js"></script>
<script src="revisionEngine.js"></script>
<script src="scheduler.js"></script>
<script src="intelligence.js"></script>
<script src="charts.js"></script>
<script src="stopwatch.js"></script>
<script src="supabase.js"></script>
<script src="cardSync.js"></script>
<script src="noteSync.js"></script>
<script src="app.js"></script>
<script>
  // Init planner page
  document.addEventListener("DOMContentLoaded", function() {
    if (typeof renderSavedPlan    === "function") renderSavedPlan();
    if (typeof renderHeatmap      === "function") renderHeatmap();
    if (typeof renderEveningUpdate === "function") renderEveningUpdate();
    swInit();

    // Populate pin dropdown with current subjects (#16)
    let sel = document.getElementById("pinSubjectSelect");
    if (sel && studyData?.subjects) {
      Object.keys(studyData.subjects).forEach(name => {
        let opt = document.createElement("option");
        opt.value = name; opt.textContent = name;
        sel.appendChild(opt);
      });
    }
    // Restore pinned state
    if (studyData?.pinnedSubjectDate === (typeof today==="function"?today():"") && studyData?.pinnedSubject) {
      if (sel) sel.value = studyData.pinnedSubject;
      let btn = document.getElementById("pinBtn");
      if (btn) { btn.textContent = "✓ Pinned"; btn.className = "pin-btn-pinned"; btn.style.fontSize="12px"; btn.style.padding="6px 10px"; btn.style.margin="0"; }
    }
  });

  function pinSubjectForToday() {
    let sel = document.getElementById("pinSubjectSelect");
    if (!sel?.value) return;
    studyData.pinnedSubject     = sel.value;
    studyData.pinnedSubjectDate = (typeof today==="function") ? today() : new Date().toISOString().split("T")[0];
    if (typeof saveData==="function") saveData();
    let btn = document.getElementById("pinBtn");
    if (btn) { btn.textContent = "✓ Pinned"; btn.className = "pin-btn-pinned"; btn.style.fontSize="12px"; btn.style.padding="6px 10px"; btn.style.margin="0"; }
  }

  function unpinSubject() {
    delete studyData.pinnedSubject;
    delete studyData.pinnedSubjectDate;
    if (typeof saveData==="function") saveData();
    let btn = document.getElementById("pinBtn");
    if (btn) { btn.textContent = "📌 Pin"; btn.className = "pin-btn-default"; btn.style.fontSize="12px"; btn.style.padding="6px 10px"; btn.style.margin="0"; }
    let sel = document.getElementById("pinSubjectSelect");
    if (sel) sel.value = "";
  }
</script>

<script src="rotateScreen.js"></script>
<script src="notifications.js"></script>
<script src="pomodoro.js"></script>
<script src="search.js"></script>
<script src="pwa.js"></script>
</body>
</html>
