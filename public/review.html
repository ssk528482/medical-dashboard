<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Review ‚Äî Medical Study OS</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    .review-page { padding: 16px; padding-bottom: 80px; max-width: 680px; margin: 0 auto; }
    .review-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; font-size: 13px; color: var(--text-muted); }
    .review-title { font-size: 18px; font-weight: 700; color: var(--text); }
    #review-timer { font-variant-numeric: tabular-nums; font-weight: 600; color: var(--text-muted); }

    /* Progress bar */
    .progress-bar-wrap { margin-bottom: 6px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
    .progress-bar-fill { height: 100%; background: var(--blue); transition: width 0.3s ease; width: 0%; }
    .progress-label { font-size: 11px; color: var(--text-dim); text-align: right; margin-bottom: 14px; }

    /* Card flip */
    #card-wrapper { perspective: 1200px; min-height: 260px; margin-bottom: 16px; cursor: pointer; }
    #review-card {
      width: 100%; min-height: 260px; position: relative;
      transform-style: preserve-3d;
      transition: transform 0.45s cubic-bezier(0.4,0,0.2,1);
      border-radius: 16px;
    }
    #review-card.flipped { transform: rotateY(180deg); }
    .card-face {
      position: absolute; width: 100%; min-height: 260px;
      backface-visibility: hidden; -webkit-backface-visibility: hidden;
      border-radius: 16px; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 28px; box-sizing: border-box;
      background: var(--surface); border: 1.5px solid var(--border);
      box-shadow: 0 4px 24px rgba(0,0,0,0.2);
    }
    .card-face.back { transform: rotateY(180deg); background: var(--card); }
    .card-face-text { font-size: 18px; font-weight: 500; text-align: center; color: var(--text); line-height: 1.5; }
    .card-face-img  { max-width: 100%; max-height: 160px; object-fit: contain; border-radius: 8px; margin-top: 12px; }
    .card-hint { margin-top: 12px; font-size: 12px; color: var(--text-dim); }

    /* Flip button */
    #btn-flip {
      width: 100%; padding: 14px; border-radius: 12px; border: none;
      background: var(--blue); color: #fff; font-size: 15px; font-weight: 700;
      cursor: pointer; margin-bottom: 12px; min-height: unset;
    }

    /* Rating buttons */
    #rating-btns { display: none; grid-template-columns: repeat(4,1fr); gap: 8px; margin-bottom: 12px; }
    #rating-btns.visible { display: grid; }
    .rating-btn { padding: 12px 0; border: none; border-radius: 10px; font-size: 13px; font-weight: 700; cursor: pointer; min-height: unset; margin: 0; transition: transform 0.1s; }
    .rating-btn:active { transform: scale(0.95); }
    .rating-btn[data-r="1"] { background: #fdecea; color: #c0392b; }
    .rating-btn[data-r="2"] { background: #fef3e2; color: #e67e22; }
    .rating-btn[data-r="3"] { background: #eafaf1; color: #27ae60; }
    .rating-btn[data-r="4"] { background: #eaf4fd; color: #2980b9; }

    /* Card actions (edit/delete) */
    #card-actions { display: none; justify-content: center; gap: 10px; margin-bottom: 12px; }
    #card-actions.visible { display: flex; }
    .card-action-btn {
      padding: 7px 16px; border-radius: 8px; font-size: 12px; font-weight: 600;
      cursor: pointer; border: 1px solid var(--border); min-height: unset; margin: 0;
      background: var(--card); color: var(--text-muted);
    }
    .card-action-btn:hover { opacity: 0.85; box-shadow: none; }

    /* Streak badge */
    #streak-badge {
      display: inline-block; position: fixed; top: 70px; right: 20px;
      background: rgba(245,158,11,0.18); color: var(--yellow);
      border: 1px solid rgba(245,158,11,0.3); border-radius: 20px;
      padding: 4px 12px; font-size: 12px; font-weight: 700;
      opacity: 0; transition: opacity 0.3s;
    }
    #streak-badge.visible { opacity: 1; }

    /* Start / empty / complete screens */
    .review-screen {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 48px 24px; text-align: center; gap: 14px;
    }
    .review-big-icon { font-size: 56px; }
    .review-count-label { font-size: 26px; font-weight: 700; }
    .review-sub-label { font-size: 14px; color: var(--text-muted); }
    .btn-start {
      background: var(--blue); color: #fff; border: none; border-radius: 12px;
      padding: 14px 32px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 8px; min-height: unset;
    }
    .btn-back-browse {
      background: var(--card); color: var(--text-muted); border: 1px solid var(--border);
      border-radius: 12px; padding: 12px 24px; font-size: 14px; font-weight: 600;
      cursor: pointer; text-decoration: none; display: inline-block;
    }

    /* Summary grid */
    .summary-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 12px; margin: 12px 0; width: 100%; max-width: 320px; }
    .summary-cell { background: var(--card); border: 1.5px solid var(--border); border-radius: 12px; padding: 14px; text-align: center; }
    .sc-value { font-size: 24px; font-weight: 700; }
    .sc-label { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
    .summary-cell.again .sc-value { color: #c0392b; }
    .summary-cell.hard  .sc-value { color: #e67e22; }
    .summary-cell.good  .sc-value { color: #27ae60; }
    .summary-cell.easy  .sc-value { color: #2980b9; }

    /* Inline edit modal */
    .edit-modal-backdrop {
      display: none; position: fixed; inset: 0; z-index: 600;
      background: rgba(0,0,0,0.65); backdrop-filter: blur(4px);
      align-items: center; justify-content: center; padding: 16px;
    }
    .edit-modal-backdrop.open { display: flex; }
    .edit-modal-sheet {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius-lg); padding: 22px; width: 100%; max-width: 480px;
    }
    .edit-modal-title { font-size: 15px; font-weight: 700; display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
    .edit-modal-close { background: transparent; border: 1px solid var(--border); color: var(--text-dim); padding: 3px 9px; border-radius: 6px; font-size: 13px; cursor: pointer; margin: 0; min-height: unset; }
    .edit-label { font-size: 10px; font-weight: 700; text-transform: uppercase; color: var(--text-dim); letter-spacing: .06em; display: block; margin-bottom: 4px; }
    .edit-textarea {
      width: 100%; background: var(--card); color: var(--text);
      border: 1px solid var(--border); border-radius: var(--radius-sm);
      padding: 9px 11px; font-size: 13px; font-family: inherit; resize: vertical;
      margin-bottom: 10px; min-height: unset;
    }
    .edit-textarea:focus { border-color: var(--blue); outline: none; }
    .edit-save-btn {
      width: 100%; background: var(--blue); color: #fff; border: none;
      padding: 10px; border-radius: var(--radius-sm); font-size: 14px; font-weight: 700;
      cursor: pointer; margin: 0; min-height: unset;
    }

    /* Confirm modal */
    .confirm-backdrop {
      display: none; position: fixed; inset: 0; z-index: 700;
      background: rgba(0,0,0,0.65); backdrop-filter: blur(4px);
      align-items: center; justify-content: center; padding: 16px;
    }
    .confirm-backdrop.open { display: flex; }
    .confirm-box { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 24px; width: 100%; max-width: 340px; text-align: center; }
    .confirm-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
    .confirm-body  { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; }
    .confirm-btns  { display: flex; gap: 10px; justify-content: center; }
    .confirm-cancel { background: var(--card); color: var(--text-muted); border: 1px solid var(--border); padding: 9px 20px; border-radius: var(--radius-sm); cursor: pointer; font-size: 13px; min-height: unset; margin: 0; }
    .confirm-ok { background: var(--red); color: #fff; border: none; padding: 9px 20px; border-radius: var(--radius-sm); cursor: pointer; font-size: 13px; font-weight: 700; min-height: unset; margin: 0; }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê SIDE NAV ‚ïê‚ïê‚ïê -->
<nav class="side-nav" id="side-nav">
  <button class="side-nav-toggle" id="side-nav-toggle" title="Toggle sidebar">‚ùÆ</button>
  <div class="side-nav-brand">
    <span class="side-nav-brand-icon">ü©∫</span>
    <span class="side-nav-brand-text">Medical OS</span>
  </div>
  <div class="side-nav-items">
    <a href="index.html"     class="side-nav-item"><span class="side-nav-icon">üè†</span><span class="side-nav-label">Home</span></a>
    <a href="planner.html"   class="side-nav-item"><span class="side-nav-icon">üìÖ</span><span class="side-nav-label">Planner</span></a>
    <a href="editor.html"    class="side-nav-item"><span class="side-nav-icon">üìö</span><span class="side-nav-label">Syllabus</span></a>
    <a href="analytics.html" class="side-nav-item"><span class="side-nav-icon">üìä</span><span class="side-nav-label">Stats</span></a>
    <a href="profile.html"   class="side-nav-item"><span class="side-nav-icon">üë§</span><span class="side-nav-label">Profile</span></a>
    <a href="review.html"    class="side-nav-item active"><span class="side-nav-icon">üîÅ</span><span class="side-nav-label">Review</span><span class="side-nav-review-badge" id="nav-review-badge" style="display:none"></span></a>
    <a href="browse.html"    class="side-nav-item"><span class="side-nav-icon">üÉè</span><span class="side-nav-label">Cards</span></a>
    <a href="notes.html"     class="side-nav-item"><span class="side-nav-icon">üìù</span><span class="side-nav-label">Notes</span></a>
  </div>
</nav>
<script>
(function(){
  var nav = document.getElementById('side-nav');
  var btn = document.getElementById('side-nav-toggle');
  if (localStorage.getItem('navCollapsed') === '1') {
    nav.classList.add('collapsed'); document.body.classList.add('nav-collapsed');
    if (btn) btn.textContent = '‚ùØ';
  }
  if (btn) btn.addEventListener('click', function() {
    var c = nav.classList.toggle('collapsed');
    document.body.classList.toggle('nav-collapsed', c);
    btn.textContent = c ? '‚ùØ' : '‚ùÆ';
    localStorage.setItem('navCollapsed', c ? '1' : '0');
  });
})();
</script>

<!-- ‚ïê‚ïê‚ïê STREAK BADGE ‚ïê‚ïê‚ïê -->
<div id="streak-badge"></div>

<div class="review-page">

  <!-- START SCREEN -->
  <div id="screen-start" class="review-screen">
    <div class="review-big-icon">üîÅ</div>
    <div class="review-count-label" id="start-count">Loading‚Ä¶</div>
    <div class="review-sub-label"   id="start-sub"></div>
    <button class="btn-start" id="btn-start">Start Review</button>
    <a href="browse.html" class="btn-back-browse">‚Üê Back to Cards</a>
  </div>

  <!-- EMPTY SCREEN -->
  <div id="screen-empty" class="review-screen" style="display:none">
    <div class="review-big-icon">üéâ</div>
    <div class="review-count-label">All caught up!</div>
    <div class="review-sub-label">No cards due for review today.</div>
    <a href="browse.html" class="btn-back-browse">‚Üê Browse Cards</a>
  </div>

  <!-- SESSION -->
  <div id="screen-session" style="display:none">
    <!-- Header row -->
    <div class="review-header">
      <div>
        <div class="review-title">üîÅ Review</div>
        <div id="card-counter" style="font-size:12px;color:var(--text-dim);margin-top:2px;"></div>
      </div>
      <div id="review-timer">00:00</div>
    </div>

    <!-- Progress -->
    <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progress-fill"></div></div>
    <div class="progress-label" id="progress-label"></div>

    <!-- Flip card -->
    <div id="card-wrapper" onclick="flipCard()">
      <div id="review-card">
        <div class="card-face front" id="card-front">
          <div class="card-face-text" id="card-front-text"></div>
          <img  class="card-face-img"  id="card-front-img" src="" style="display:none"/>
          <div class="card-hint">Tap to reveal</div>
        </div>
        <div class="card-face back" id="card-back">
          <div class="card-face-text" id="card-back-text"></div>
          <img  class="card-face-img"  id="card-back-img" src="" style="display:none"/>
        </div>
      </div>
    </div>

    <!-- Flip button -->
    <button id="btn-flip" onclick="flipCard()">Show Answer</button>

    <!-- Rating buttons -->
    <div id="rating-btns">
      <button class="rating-btn" data-r="1" onclick="rateCard(1)">üò∞ Again</button>
      <button class="rating-btn" data-r="2" onclick="rateCard(2)">üòê Hard</button>
      <button class="rating-btn" data-r="3" onclick="rateCard(3)">üôÇ Good</button>
      <button class="rating-btn" data-r="4" onclick="rateCard(4)">üòÑ Easy</button>
    </div>

    <!-- Card actions (edit / delete) -->
    <div id="card-actions">
      <button class="card-action-btn" onclick="openEditModal()">‚úèÔ∏è Edit Card</button>
      <button class="card-action-btn" onclick="deleteCurrentCard()" style="color:var(--red);border-color:rgba(239,68,68,0.3)">üóëÔ∏è Delete</button>
    </div>
  </div>

  <!-- COMPLETE SCREEN -->
  <div id="screen-complete" class="review-screen" style="display:none">
    <div class="review-big-icon">üèÜ</div>
    <div class="review-count-label">Session Complete!</div>
    <div class="summary-grid">
      <div class="summary-cell again"><div class="sc-value" id="sum-again">0</div><div class="sc-label">Again</div></div>
      <div class="summary-cell hard"> <div class="sc-value" id="sum-hard">0</div> <div class="sc-label">Hard</div></div>
      <div class="summary-cell good"> <div class="sc-value" id="sum-good">0</div> <div class="sc-label">Good</div></div>
      <div class="summary-cell easy"> <div class="sc-value" id="sum-easy">0</div> <div class="sc-label">Easy</div></div>
    </div>
    <div class="review-sub-label" id="sum-retention"></div>
    <div class="review-sub-label" id="sum-time"></div>
    <div class="review-sub-label" id="sum-tomorrow"></div>
    <a href="browse.html" class="btn-back-browse" style="margin-top:8px;">‚Üê Back to Cards</a>
  </div>

</div><!-- /review-page -->

<!-- ‚ïê‚ïê‚ïê INLINE EDIT MODAL ‚ïê‚ïê‚ïê -->
<div class="edit-modal-backdrop" id="edit-modal" onclick="if(event.target===this)closeEditModal()">
  <div class="edit-modal-sheet">
    <div class="edit-modal-title">
      ‚úèÔ∏è Edit Card
      <button class="edit-modal-close" onclick="closeEditModal()">‚úï</button>
    </div>
    <span class="edit-label">Front</span>
    <textarea class="edit-textarea" id="edit-front" rows="3" placeholder="Front text‚Ä¶"></textarea>
    <span class="edit-label">Back</span>
    <textarea class="edit-textarea" id="edit-back"  rows="3" placeholder="Back text‚Ä¶"></textarea>
    <button class="edit-save-btn" onclick="saveEdit()">üíæ Save Changes</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê CONFIRM MODAL ‚ïê‚ïê‚ïê -->
<div class="confirm-backdrop" id="confirm-modal" onclick="if(event.target===this)closeConfirm()">
  <div class="confirm-box">
    <div class="confirm-title" id="confirm-title">Confirm</div>
    <div class="confirm-body"  id="confirm-body"></div>
    <div class="confirm-btns">
      <button class="confirm-cancel" onclick="closeConfirm()">Cancel</button>
      <button class="confirm-ok" id="confirm-ok" onclick="runConfirm()">Delete</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SCRIPTS ‚ïê‚ïê‚ïê -->
<script src="utils.js"></script>
<script src="data.js"></script>
<script src="supabase.js"></script>
<script src="cardSync.js"></script>
<script src="review.js"></script>
</body>
</html>
