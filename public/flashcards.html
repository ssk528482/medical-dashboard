<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flashcards â€” Medical Study OS</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* â”€â”€ Tab bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .fc-tabs {
      display: flex;
      border-bottom: 2px solid var(--border, #e0e0e0);
      background: var(--surface, #fff);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .fc-tab {
      flex: 1;
      padding: 14px 0;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-muted, #888);
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: color 0.2s, border-color 0.2s;
      user-select: none;
    }
    .fc-tab.active {
      color: var(--primary, #4a90e2);
      border-bottom-color: var(--primary, #4a90e2);
    }
    .fc-panel {
      display: none;
      padding: 16px;
      padding-bottom: 80px; /* clearance for bottom nav */
    }
    .fc-panel.active {
      display: block;
    }

    /* â”€â”€ Review tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      font-size: 14px;
      color: var(--text-muted, #888);
    }
    #review-timer {
      font-variant-numeric: tabular-nums;
      font-weight: 600;
    }
    #review-card-wrapper {
      perspective: 1200px;
      min-height: 240px;
      margin-bottom: 16px;
      cursor: pointer;
    }
    #review-card {
      width: 100%;
      min-height: 240px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.45s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 16px;
    }
    #review-card.flipped {
      transform: rotateY(180deg);
    }
    .card-face {
      position: absolute;
      width: 100%;
      min-height: 240px;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      box-sizing: border-box;
      box-shadow: 0 4px 20px rgba(0,0,0,0.10);
      background: var(--surface, #fff);
      border: 1.5px solid var(--border, #e0e0e0);
    }
    .card-face.back {
      transform: rotateY(180deg);
      background: var(--surface-alt, #f9f9f9);
    }
    .card-face-text {
      font-size: 18px;
      font-weight: 500;
      text-align: center;
      color: var(--text, #222);
      line-height: 1.5;
    }
    .card-face-image {
      max-width: 100%;
      max-height: 160px;
      object-fit: contain;
      border-radius: 8px;
      margin-top: 12px;
    }
    .card-tap-hint {
      margin-top: 12px;
      font-size: 12px;
      color: var(--text-muted, #aaa);
    }
    #review-progress-bar {
      width: 100%;
      height: 6px;
      background: var(--border, #e0e0e0);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    #review-progress-fill {
      height: 100%;
      background: var(--primary, #4a90e2);
      transition: width 0.3s ease;
      width: 0%;
    }
    #review-progress-label {
      font-size: 12px;
      color: var(--text-muted, #888);
      text-align: right;
      margin-top: -12px;
      margin-bottom: 16px;
    }
    #review-rating-buttons {
      display: none; /* shown after flip */
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 8px;
    }
    #review-rating-buttons.visible {
      display: grid;
    }
    .rating-btn {
      padding: 12px 0;
      border: none;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: opacity 0.15s, transform 0.1s;
    }
    .rating-btn:active { transform: scale(0.95); }
    .rating-btn[data-rating="1"] { background: #fdecea; color: #c0392b; }
    .rating-btn[data-rating="2"] { background: #fef3e2; color: #e67e22; }
    .rating-btn[data-rating="3"] { background: #eafaf1; color: #27ae60; }
    .rating-btn[data-rating="4"] { background: #eaf4fd; color: #2980b9; }

    /* Start screen & empty state */
    #review-start-screen,
    #review-empty-state,
    #review-complete-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 48px 24px;
      text-align: center;
      gap: 12px;
    }
    .review-big-icon { font-size: 56px; }
    .review-count-label { font-size: 28px; font-weight: 700; color: var(--text, #222); }
    .review-sub-label  { font-size: 14px; color: var(--text-muted, #888); }
    .btn-primary {
      background: var(--primary, #4a90e2);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 14px 32px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 8px;
      transition: opacity 0.2s;
    }
    .btn-primary:hover { opacity: 0.88; }

    /* Session summary */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 16px 0;
      width: 100%;
      max-width: 360px;
    }
    .summary-cell {
      background: var(--surface, #fff);
      border: 1.5px solid var(--border, #e0e0e0);
      border-radius: 12px;
      padding: 14px;
      text-align: center;
    }
    .summary-cell .sc-value { font-size: 24px; font-weight: 700; }
    .summary-cell .sc-label { font-size: 12px; color: var(--text-muted, #888); margin-top: 2px; }
    .summary-cell.again  .sc-value { color: #c0392b; }
    .summary-cell.hard   .sc-value { color: #e67e22; }
    .summary-cell.good   .sc-value { color: #27ae60; }
    .summary-cell.easy   .sc-value { color: #2980b9; }

    /* â”€â”€ Browse tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #browse-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }
    .filter-select {
      flex: 1 1 140px;
      padding: 9px 10px;
      border: 1.5px solid var(--border, #e0e0e0);
      border-radius: 8px;
      font-size: 13px;
      background: var(--surface, #fff);
      color: var(--text, #222);
    }
    #browse-search {
      width: 100%;
      padding: 10px 12px;
      border: 1.5px solid var(--border, #e0e0e0);
      border-radius: 8px;
      font-size: 14px;
      background: var(--surface, #fff);
      color: var(--text, #222);
      box-sizing: border-box;
      margin-bottom: 12px;
    }
    #browse-card-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .browse-card-item {
      background: var(--surface, #fff);
      border: 1.5px solid var(--border, #e0e0e0);
      border-radius: 12px;
      padding: 14px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }
    .bci-content { flex: 1; min-width: 0; }
    .bci-front {
      font-size: 14px;
      font-weight: 500;
      color: var(--text, #222);
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .bci-meta {
      font-size: 12px;
      color: var(--text-muted, #888);
    }
    .bci-actions { display: flex; gap: 6px; flex-shrink: 0; }
    .icon-btn {
      background: none;
      border: 1.5px solid var(--border, #ddd);
      border-radius: 8px;
      width: 34px;
      height: 34px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.15s;
    }
    .icon-btn:hover { background: var(--surface-alt, #f4f4f4); }
    #browse-empty {
      text-align: center;
      color: var(--text-muted, #aaa);
      padding: 48px 24px;
      font-size: 15px;
    }

    /* â”€â”€ Create tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card-type-toggle {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    .type-btn {
      flex: 1;
      padding: 9px 0;
      border: 1.5px solid var(--border, #e0e0e0);
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      background: var(--surface, #fff);
      color: var(--text-muted, #888);
      cursor: pointer;
      transition: all 0.15s;
      text-align: center;
    }
    .type-btn.active {
      background: var(--primary, #4a90e2);
      color: #fff;
      border-color: var(--primary, #4a90e2);
    }
    .form-group {
      margin-bottom: 14px;
    }
    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted, #888);
      margin-bottom: 6px;
    }
    .form-textarea {
      width: 100%;
      min-height: 100px;
      padding: 10px 12px;
      border: 1.5px solid var(--border, #e0e0e0);
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      box-sizing: border-box;
      background: var(--surface, #fff);
      color: var(--text, #222);
    }
    .form-select, .form-input {
      width: 100%;
      padding: 10px 12px;
      border: 1.5px solid var(--border, #e0e0e0);
      border-radius: 8px;
      font-size: 14px;
      box-sizing: border-box;
      background: var(--surface, #fff);
      color: var(--text, #222);
    }
    .image-upload-box {
      border: 2px dashed var(--border, #ccc);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      color: var(--text-muted, #aaa);
      cursor: pointer;
      font-size: 13px;
      transition: border-color 0.2s;
    }
    .image-upload-box:hover { border-color: var(--primary, #4a90e2); }
    .image-preview-wrap {
      display: none;
      position: relative;
      margin-top: 8px;
    }
    .image-preview-wrap img {
      max-width: 100%;
      max-height: 160px;
      object-fit: contain;
      border-radius: 8px;
    }
    .remove-image-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(0,0,0,0.55);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .upload-progress {
      display: none;
      font-size: 12px;
      color: var(--primary, #4a90e2);
      margin-top: 4px;
    }
    .link-selectors {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
    }
    .tag-input-wrap {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      border: 1.5px solid var(--border, #e0e0e0);
      border-radius: 8px;
      padding: 8px;
      min-height: 42px;
      align-items: center;
      background: var(--surface, #fff);
    }
    .tag-chip {
      background: var(--primary-light, #eaf4fd);
      color: var(--primary, #2980b9);
      border-radius: 20px;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .tag-chip-remove {
      cursor: pointer;
      font-size: 13px;
      color: var(--text-muted, #aaa);
      line-height: 1;
    }
    .tag-text-input {
      border: none;
      outline: none;
      font-size: 13px;
      min-width: 80px;
      background: transparent;
      color: var(--text, #222);
    }
    .form-row-buttons {
      display: flex;
      gap: 10px;
      margin-top: 8px;
    }
    .btn-secondary {
      background: var(--surface-alt, #f4f4f4);
      color: var(--text, #333);
      border: 1.5px solid var(--border, #ddd);
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    #ai-generate-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 100;
      align-items: flex-end;
      justify-content: center;
    }
    #ai-generate-modal.open {
      display: flex;
    }
    .modal-sheet {
      background: var(--surface, #fff);
      border-radius: 20px 20px 0 0;
      padding: 24px;
      width: 100%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-sizing: border-box;
    }
    .modal-title {
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 12px;
    }
    #ai-preview-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 12px 0;
      max-height: 300px;
      overflow-y: auto;
    }
    .ai-preview-card {
      border: 1.5px solid var(--border, #ddd);
      border-radius: 10px;
      padding: 12px;
      background: var(--surface-alt, #f9f9f9);
    }
    .ai-preview-card textarea {
      width: 100%;
      border: none;
      background: transparent;
      resize: none;
      font-size: 13px;
      font-family: inherit;
      color: var(--text, #222);
      outline: none;
    }
    .ai-preview-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-muted, #888);
    }
  </style>
</head>
<body>
<nav class="side-nav" id="side-nav">
  <button class="side-nav-toggle" id="side-nav-toggle" title="Toggle sidebar">â®</button>
  <div class="side-nav-brand">
    <span class="side-nav-brand-icon">ğŸ©º</span>
    <span class="side-nav-brand-text">Medical OS</span>
  </div>
    <div class="side-nav-items">
    <a href="index.html"      class="side-nav-item "     data-label="Home">     <span class="side-nav-icon">ğŸ </span><span class="side-nav-label">Home</span></a>
    <a href="planner.html"    class="side-nav-item "  data-label="Planner">  <span class="side-nav-icon">ğŸ“…</span><span class="side-nav-label">Planner</span></a>
    <a href="editor.html"     class="side-nav-item "   data-label="Syllabus"> <span class="side-nav-icon">ğŸ“š</span><span class="side-nav-label">Syllabus</span></a>
    <a href="analytics.html"  class="side-nav-item " data-label="Stats">   <span class="side-nav-icon">ğŸ“Š</span><span class="side-nav-label">Stats</span></a>
    <a href="profile.html"    class="side-nav-item "  data-label="Profile">  <span class="side-nav-icon">ğŸ‘¤</span><span class="side-nav-label">Profile</span></a>
    <a href="flashcards.html?tab=review" class="side-nav-item " data-label="Review"><span class="side-nav-icon">ğŸ”</span><span class="side-nav-label">Review</span><span class="side-nav-review-badge" id="nav-review-badge" style="display:none"></span></a>
    <a href="flashcards.html" class="side-nav-item active"    data-label="Cards">    <span class="side-nav-icon">ğŸƒ</span><span class="side-nav-label">Cards</span></a>
    <a href="notes.html"      class="side-nav-item "    data-label="Notes">    <span class="side-nav-icon">ğŸ“</span><span class="side-nav-label">Notes</span></a>
  </div>
</nav>
<script>
(function(){
  var nav = document.getElementById('side-nav');
  var btn = document.getElementById('side-nav-toggle');
  if (localStorage.getItem('navCollapsed') === '1') {
    nav.classList.add('collapsed');
    document.body.classList.add('nav-collapsed');
    if (btn) btn.textContent = 'â¯';
  }
  if (btn) btn.addEventListener('click', function() {
    var c = nav.classList.toggle('collapsed');
    document.body.classList.toggle('nav-collapsed', c);
    btn.textContent = c ? 'â¯' : 'â®';
    localStorage.setItem('navCollapsed', c ? '1' : '0');
  });
})();
</script>

  <!-- â”€â”€ Page header â”€â”€ -->
  <header class="page-header">
    <h1 class="page-title" id="fc-page-title">ğŸƒ Flashcards</h1>
  </header>

  <!-- â”€â”€ Tab bar (Browse + Create only; hidden when in Review mode) â”€â”€ -->
  <div class="fc-tabs" id="fc-tabs-bar">
    <div class="fc-tab active" data-tab="browse">Browse</div>
    <div class="fc-tab"        data-tab="create">Create</div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       REVIEW PANEL (shown when ?tab=review or from side nav)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="fc-panel" id="panel-review" style="display:none">

    <!-- Start screen (shown before session begins) -->
    <div id="review-start-screen">
      <div class="review-big-icon">ğŸƒ</div>
      <div class="review-count-label" id="due-count-label">Loadingâ€¦</div>
      <div class="review-sub-label"   id="due-sub-label"></div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:8px;">
        <button class="btn-primary" id="btn-start-review">Start Review</button>
        <button style="background:var(--card);color:var(--text-muted);border:1px solid var(--border);border-radius:12px;padding:14px 24px;font-size:14px;font-weight:600;cursor:pointer;margin-top:0;" onclick="showPanel('browse')">Browse Cards</button>
      </div>
    </div>

    <!-- Empty state (no cards due) -->
    <div id="review-empty-state" style="display:none">
      <div class="review-big-icon">âœ…</div>
      <div class="review-count-label">All caught up!</div>
      <div class="review-sub-label">No cards due today. Come back tomorrow.</div>
      <button class="btn-primary" onclick="showPanel('create')">Create Cards</button>
    </div>

    <!-- Active session (hidden until started) -->
    <div id="review-session" style="display:none">
      <div id="review-header">
        <span id="review-card-counter">Card 1 of 47</span>
        <span id="review-streak-badge" class="hidden">ğŸ”¥ 0</span>
        <span id="review-timer">00:00</span>
      </div>

      <div id="review-progress-bar">
        <div id="review-progress-fill"></div>
      </div>
      <div id="review-progress-label">0 / 0</div>

      <div id="review-card-wrapper" onclick="flipCard()">
        <div id="review-card">
          <div class="card-face front" id="card-front">
            <div class="card-face-text" id="card-front-text"></div>
            <img  class="card-face-image" id="card-front-img" src="" alt="" style="display:none"/>
            <div class="card-tap-hint">Tap to reveal answer</div>
          </div>
          <div class="card-face back" id="card-back">
            <div class="card-face-text" id="card-back-text"></div>
            <img  class="card-face-image" id="card-back-img" src="" alt="" style="display:none"/>
          </div>
        </div>
      </div>

      <div id="review-rating-buttons">
        <button class="rating-btn" data-rating="1" onclick="rateCard(1)">1<br>Again</button>
        <button class="rating-btn" data-rating="2" onclick="rateCard(2)">2<br>Hard</button>
        <button class="rating-btn" data-rating="3" onclick="rateCard(3)">3<br>Good</button>
        <button class="rating-btn" data-rating="4" onclick="rateCard(4)">4<br>Easy</button>
      </div>

      <!-- Edit/Delete actions (shown after flip) -->
      <div id="review-card-actions">
        <button class="review-card-action-btn edit" onclick="reviewEditCard()">âœï¸ Edit</button>
        <button class="review-card-action-btn del"  onclick="reviewDeleteCard()">ğŸ—‘ï¸ Delete</button>
      </div>

      <!-- Keyboard shortcut hint -->
      <div id="review-kb-hint">
        <kbd>Space</kbd> flip &nbsp;Â·&nbsp; <kbd>1</kbd>â€“<kbd>4</kbd> rate &nbsp;Â·&nbsp; <kbd>E</kbd> edit
      </div>
    </div>

    <!-- Session complete screen -->
    <div id="review-complete-screen" style="display:none">
      <div class="review-big-icon">ğŸ‰</div>
      <div class="review-count-label">Session Complete</div>
      <div class="summary-grid">
        <div class="summary-cell again">
          <div class="sc-value" id="summary-again">0</div>
          <div class="sc-label">Again</div>
        </div>
        <div class="summary-cell hard">
          <div class="sc-value" id="summary-hard">0</div>
          <div class="sc-label">Hard</div>
        </div>
        <div class="summary-cell good">
          <div class="sc-value" id="summary-good">0</div>
          <div class="sc-label">Good</div>
        </div>
        <div class="summary-cell easy">
          <div class="sc-value" id="summary-easy">0</div>
          <div class="sc-label">Easy</div>
        </div>
      </div>
      <div class="review-sub-label" id="summary-retention"></div>
      <div class="review-sub-label" id="summary-time"></div>
      <div class="review-sub-label" id="summary-tomorrow"></div>
      <button class="btn-primary" onclick="showPanel('browse')">Done</button>
    </div>

  </div><!-- /panel-review -->


  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 1 â€” BROWSE (New / Revise accordion)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="fc-panel active" id="panel-browse">

    <!-- Sub-tabs + actions row -->
    <div style="display:flex;align-items:center;gap:8px;padding:0 0 8px;">
      <div class="fc-browse-subtabs" style="flex:1;margin-bottom:0;">
        <button class="fc-browse-subtab active" id="browse-sub-new"    onclick="switchBrowseSubTab('new')">ğŸ†• New</button>
        <button class="fc-browse-subtab"        id="browse-sub-revise" onclick="switchBrowseSubTab('revise')">ğŸ” Revise</button>
        <button class="fc-browse-subtab"        id="browse-sub-all"    onclick="switchBrowseSubTab('all')">ğŸ“‹ All</button>
      </div>
      <button onclick="openCsvImportModal()" style="background:var(--card);color:var(--text-muted);border:1px solid var(--border);border-radius:var(--radius-sm);font-size:11px;font-weight:700;padding:6px 10px;margin:0;min-height:unset;white-space:nowrap;cursor:pointer;flex-shrink:0;">ğŸ“¥ Import</button>
      <button onclick="toggleBrowseSelectMode()" id="browse-select-btn" style="background:var(--card);color:var(--text-muted);border:1px solid var(--border);border-radius:var(--radius-sm);font-size:11px;font-weight:700;padding:6px 10px;margin:0;min-height:unset;white-space:nowrap;cursor:pointer;flex-shrink:0;">â˜‘ Select</button>
    </div>

    <!-- Search row -->
    <div class="fc-browse-search-row">
      <input type="text" id="browse-search" placeholder="ğŸ” Search cardsâ€¦" oninput="browseSearch()" />
    </div>

    <!-- Accordion list -->
    <div id="browse-accordion">
      <div class="fc-browse-loading">Loading cardsâ€¦</div>
    </div>

  </div><!-- /panel-browse -->


  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 2 â€” CREATE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="fc-panel" id="panel-create">

    <!-- Card type selector -->
    <div class="card-type-toggle">
      <button class="type-btn active" data-type="basic"            onclick="setCardType('basic')">Basic</button>
      <button class="type-btn"        data-type="cloze"            onclick="setCardType('cloze')">Cloze</button>
      <button class="type-btn"        data-type="image_occlusion"  onclick="setCardType('image_occlusion')">Image Occ.</button>
    </div>

    <!-- Front -->
    <div class="form-group">
      <label class="form-label">Front</label>
      <textarea class="form-textarea" id="create-front" placeholder="Question or promptâ€¦"
        oninput="updateClozePreview()"></textarea>
      <div class="image-upload-box" id="front-upload-box"
           onclick="document.getElementById('front-file-input').click()">
        ğŸ“· Add image to front
      </div>
      <input type="file" id="front-file-input" accept="image/*" style="display:none"
             onchange="handleImageSelect('front', this)" />
      <div class="image-preview-wrap" id="front-preview-wrap">
        <img id="front-preview-img" src="" alt="Front image preview" />
        <button class="remove-image-btn" onclick="removeImage('front')">âœ•</button>
      </div>
      <div class="upload-progress" id="front-upload-progress"></div>
    </div>

    <!-- Back (hidden for image_occlusion) -->
    <div class="form-group" id="back-group">
      <label class="form-label">Back</label>
      <textarea class="form-textarea" id="create-back" placeholder="Answer or explanationâ€¦"></textarea>
      <div class="image-upload-box" id="back-upload-box"
           onclick="document.getElementById('back-file-input').click()">
        ğŸ“· Add image to back
      </div>
      <input type="file" id="back-file-input" accept="image/*" style="display:none"
             onchange="handleImageSelect('back', this)" />
      <div class="image-preview-wrap" id="back-preview-wrap">
        <img id="back-preview-img" src="" alt="Back image preview" />
        <button class="remove-image-btn" onclick="removeImage('back')">âœ•</button>
      </div>
      <div class="upload-progress" id="back-upload-progress"></div>
    </div>

    <!-- Cloze hint -->
    <div class="form-group" id="cloze-hint" style="display:none">
      <div style="background:var(--surface-alt,#f4f4f4);border-radius:8px;padding:10px 14px;font-size:13px;color:var(--text-muted,#777)">
        ğŸ’¡ Wrap words to hide with <strong>{{double braces}}</strong>.
        Example: <em>The {{mitochondria}} is the powerhouse of the cell.</em>
      </div>
    </div>

    <!-- Image occlusion area -->
    <div id="occlusion-area" style="display:none">
      <div class="image-upload-box" id="occlusion-upload-box"
           onclick="document.getElementById('occlusion-file-input').click()">
        ğŸ“· Upload diagram for occlusion
      </div>
      <input type="file" id="occlusion-file-input" accept="image/*" style="display:none"
             onchange="initOcclusionCanvas(this)" />
      <canvas id="occlusion-canvas" style="display:none;max-width:100%;border-radius:10px;margin-top:10px;touch-action:none;"></canvas>
      <div style="font-size:12px;color:var(--text-muted,#aaa);margin-top:6px;" id="occlusion-hint" style="display:none">
        Drag to draw a box over a label. Click a box to name it.
      </div>
    </div>

    <!-- Link to subject / unit / chapter -->
    <div class="form-group">
      <label class="form-label">Link To</label>
      <div class="link-selectors">
        <select class="form-select" id="create-subject" onchange="populateUnitSelect()">
          <option value="">Subject</option>
        </select>
        <select class="form-select" id="create-unit" onchange="populateChapterSelect()">
          <option value="">Unit</option>
        </select>
        <select class="form-select" id="create-chapter">
          <option value="">Chapter</option>
        </select>
      </div>
    </div>

    <!-- Tags -->
    <div class="form-group">
      <label class="form-label">Tags</label>
      <div class="tag-input-wrap" id="tag-input-wrap" onclick="document.getElementById('tag-text-input').focus()">
        <!-- tag chips inserted here by JS -->
        <input type="text" id="tag-text-input" class="tag-text-input"
               placeholder="Type a tag, press Enter"
               onkeydown="handleTagInput(event)" />
      </div>
    </div>

    <!-- Action buttons -->
    <div class="form-row-buttons">
      <button class="btn-secondary" id="btn-ai-generate" onclick="openAiModal()">âœ¨ AI Generate</button>
      <button class="btn-primary"   id="btn-save-card"   onclick="submitCard()"
              style="flex:1">Save Card</button>
    </div>
    <div id="create-status" style="font-size:13px;color:var(--primary,#4a90e2);margin-top:10px;min-height:18px;"></div>

  </div><!-- /panel-create -->


  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AI GENERATE MODAL
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="ai-generate-modal" onclick="closeAiModalOnBackdrop(event)">
    <div class="modal-sheet">
      <div class="modal-title">âœ¨ AI Card Generator</div>
      <p style="font-size:13px;color:var(--text-muted,#888);margin:0 0 12px">
        Paste your textbook or lecture text below and Claude will generate flashcards.
      </p>
      <textarea class="form-textarea" id="ai-source-text" style="min-height:140px"
        placeholder="Paste chapter text hereâ€¦"></textarea>
      <button class="btn-primary" id="btn-run-ai" onclick="runAiGenerate()"
              style="width:100%;margin-top:10px">Generate Cards</button>
      <div id="ai-generate-status" style="font-size:13px;color:var(--primary,#4a90e2);margin-top:8px;min-height:16px;"></div>

      <div id="ai-preview-list"></div>

      <div class="form-row-buttons" id="ai-save-row" style="display:none">
        <button class="btn-secondary" onclick="closeAiModal()">Cancel</button>
        <button class="btn-primary"   onclick="saveAiCards()" style="flex:1">Save All Cards</button>
      </div>
    </div>
  </div>


  <!-- â”€â”€ Nav â”€â”€ -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BULK DELETE FLOATING BAR
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="browse-bulk-bar" id="browse-bulk-bar">
    <span class="browse-bulk-count" id="browse-bulk-count">0 selected</span>
    <button class="browse-bulk-cancel" onclick="toggleBrowseSelectMode()">Cancel</button>
    <button class="browse-bulk-delete" onclick="bulkDeleteSelected()">ğŸ—‘ï¸ Delete Selected</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GENERIC CONFIRM MODAL
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="gen-modal-backdrop" id="confirm-modal" onclick="closeConfirmModalOnBackdrop(event)">
    <div class="gen-modal-box">
      <div class="gen-modal-title" id="confirm-modal-title">Confirm Delete</div>
      <div class="gen-modal-body"  id="confirm-modal-body">This cannot be undone.</div>
      <div class="gen-modal-btns">
        <button class="gen-modal-cancel"  onclick="closeConfirmModal()">Cancel</button>
        <button class="gen-modal-confirm" id="confirm-modal-ok" onclick="runConfirmAction()">Delete</button>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EDIT CARD MODAL (in-review)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="edit-card-modal-backdrop" id="edit-card-modal" onclick="closeEditCardModalOnBackdrop(event)">
    <div class="edit-card-modal-sheet">
      <div class="edit-card-modal-title">
        âœï¸ Edit Card
        <button class="edit-card-modal-close" onclick="closeEditCardModal()">âœ•</button>
      </div>
      <span class="ecm-label">Front</span>
      <textarea class="ecm-textarea" id="ecm-front" rows="3" placeholder="Front textâ€¦"></textarea>
      <span class="ecm-label">Back</span>
      <textarea class="ecm-textarea" id="ecm-back" rows="3" placeholder="Back text (leave blank for cloze)â€¦"></textarea>
      <button class="ecm-save" onclick="saveEditCardModal()">ğŸ’¾ Save Changes</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CSV IMPORT MODAL
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="csv-modal-backdrop" id="csv-import-modal" onclick="closeCsvModalOnBackdrop(event)">
    <div class="csv-modal-sheet">
      <div class="csv-modal-title">
        ğŸ“¥ Import Cards from CSV
        <button style="background:transparent;border:1px solid var(--border);color:var(--text-dim);font-size:13px;padding:4px 10px;border-radius:var(--radius-sm);cursor:pointer;margin:0;min-height:unset;" onclick="closeCsvImportModal()">âœ•</button>
      </div>
      <div class="csv-modal-sub">Paste CSV/TSV data or upload a file. Each row = one card.</div>

      <div class="csv-settings-row">
        <div>
          <label style="font-size:10px;font-weight:700;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.06em;display:block;margin-bottom:4px;">Delimiter</label>
          <select id="csv-delimiter" onchange="csvParse()" style="min-height:34px;font-size:12px;margin:0;">
            <option value="comma">Comma  ,</option>
            <option value="tab">Tab  â‡¥</option>
            <option value="pipe">Pipe  |</option>
            <option value="semicolon">Semicolon  ;</option>
          </select>
        </div>
        <div>
          <label style="font-size:10px;font-weight:700;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.06em;display:block;margin-bottom:4px;">Subject</label>
          <select id="csv-subject" onchange="csvPopulateUnits()" style="min-height:34px;font-size:12px;margin:0;"></select>
        </div>
        <div>
          <label style="font-size:10px;font-weight:700;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.06em;display:block;margin-bottom:4px;">Unit</label>
          <select id="csv-unit" onchange="csvPopulateChapters()" style="min-height:34px;font-size:12px;margin:0;"></select>
        </div>
        <div>
          <label style="font-size:10px;font-weight:700;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.06em;display:block;margin-bottom:4px;">Chapter</label>
          <select id="csv-chapter" style="min-height:34px;font-size:12px;margin:0;"></select>
        </div>
        <div>
          <label style="font-size:10px;font-weight:700;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.06em;display:block;margin-bottom:4px;">Card Type</label>
          <select id="csv-cardtype" style="min-height:34px;font-size:12px;margin:0;">
            <option value="basic">Basic</option>
            <option value="cloze">Cloze</option>
          </select>
        </div>
      </div>

      <div class="csv-column-map" id="csv-column-map" style="display:none">
        <div>
          <label>Front column</label>
          <select id="csv-map-front"></select>
        </div>
        <div>
          <label>Back column</label>
          <select id="csv-map-back"></select>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
        <button onclick="document.getElementById('csv-file-input').click()" style="background:var(--card);color:var(--text-muted);border:1px solid var(--border);font-size:11px;padding:7px 12px;border-radius:var(--radius-sm);cursor:pointer;margin:0;min-height:unset;">ğŸ“‚ Upload file</button>
        <span style="font-size:11px;color:var(--text-dim);">or paste below</span>
        <input type="file" id="csv-file-input" accept=".csv,.tsv,.txt" style="display:none" onchange="csvLoadFile(this)" />
      </div>

      <textarea class="csv-textarea" id="csv-paste-area" placeholder="front text,back text&#10;What is ATP?,Adenosine triphosphate â€“ the energy currency of the cell&#10;The {{mitochondria}} is the powerhouse of the cell," oninput="csvParse()"></textarea>

      <button class="csv-parse-btn" onclick="csvParse()">ğŸ” Preview</button>

      <div id="csv-preview-container" style="display:none;margin-top:10px;overflow-x:auto;">
        <div id="csv-preview-count" style="font-size:11px;color:var(--text-muted);margin-bottom:4px;"></div>
        <table class="csv-preview-table" id="csv-preview-table"></table>
      </div>

      <button class="csv-import-btn" id="csv-import-btn" style="display:none" onclick="csvImport()">ğŸ“¥ Import Cards</button>
      <div class="csv-import-status" id="csv-import-status"></div>
    </div>
  </div>


  <!-- â”€â”€ Scripts â”€â”€ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="utils.js"></script>
  <script src="data.js"></script>
  <script src="supabase.js"></script>
  <script src="cloudinary.js"></script>
  <script src="cardSync.js"></script>
  <script src="cardCreator.js"></script>
  <script src="imageOcclusion.js"></script>
  <script src="flashcards.js"></script>

</body>
</html>
